- name: Install Android commandline-tools and packages
        run: |
          set -e
          mkdir -p "$ANDROID_SDK_ROOT"
          # --- DOWNLOAD: use a current commandline-tools package (updated link) ---
          echo "Downloading Android commandline tools (stable)..."
          curl -fL --retry 3 --retry-delay 5 -o cmdline-tools.zip https://dl.google.com/android/repository/commandlinetools-linux-13114758_latest.zip
          unzip -q cmdline-tools.zip -d cmdline-tools-temp
          mkdir -p "$ANDROID_SDK_ROOT/cmdline-tools/latest"
          mv cmdline-tools-temp/cmdline-tools/* "$ANDROID_SDK_ROOT/cmdline-tools/latest/"
          rm -rf cmdline-tools-temp cmdline-tools.zip
          # make sdkmanager available in this same shell by exporting PATH
          export PATH="$ANDROID_SDK_ROOT/cmdline-tools/latest/bin:$PATH"
          echo "sdkmanager location: $(which sdkmanager || echo 'not found')"
          # Use full path to sdkmanager to avoid PATH timing issues
          "$ANDROID_SDK_ROOT/cmdline-tools/latest/bin/sdkmanager" --version
          # accept licenses and install required packages non-interactively
          yes | "$ANDROID_SDK_ROOT/cmdline-tools/latest/bin/sdkmanager" --sdk_root="${ANDROID_SDK_ROOT}" "platform-tools" "platforms;android-34" "build-tools;34.0.0"
